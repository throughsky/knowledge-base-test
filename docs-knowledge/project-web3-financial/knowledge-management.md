# 业务知识管理方案

本文档定义了面向AI问答的业务知识目录结构和管理流程，目标是让AI能够准确、高效地回答业务和架构相关问题。

## 一、设计原则

### 1.1 AI友好的知识组织原则

```yaml
原则1 - 结构化优先:
  - 使用固定的文档结构模板
  - 每个知识单元有明确的元数据
  - 便于AI快速定位和检索

原则2 - 上下文自包含:
  - 每个文档能独立回答一类问题
  - 减少跨文档引用的必要性
  - 关键信息就近冗余而非过度引用

原则3 - 分层递进:
  - 入口文档 → 领域文档 → 详细文档
  - 从概览到细节逐级深入
  - AI可根据问题复杂度选择层级

原则4 - 问答导向:
  - 文档结构反映常见问题类型
  - 包含FAQ和典型场景
  - 预置AI回答的素材
```

### 1.2 知识分类维度

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        业务知识分类维度                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  按抽象层次:                    按变化频率:                              │
│  ├── 战略层 (Why)              ├── 稳定知识 (年更)                       │
│  │   └── 商业模式、目标用户     │   └── 领域模型、核心概念                │
│  ├── 战术层 (What)             ├── 演进知识 (季更)                       │
│  │   └── 业务流程、规则         │   └── 业务规则、流程                    │
│  └── 执行层 (How)              └── 动态知识 (周更)                       │
│      └── 接口、配置、操作           └── 配置参数、版本信息                │
│                                                                          │
│  按问答场景:                    按受众角色:                              │
│  ├── 概念解释类                 ├── 开发人员                             │
│  ├── 流程说明类                 ├── 产品经理                             │
│  ├── 规则查询类                 ├── 运营人员                             │
│  ├── 问题排查类                 └── 外部合作方                           │
│  └── 最佳实践类                                                          │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 二、知识目录结构

### 2.1 推荐目录结构

```
docs-knowledge/
├── INDEX.md                          # 知识库总入口 (AI首选读取)
├── GLOSSARY.md                       # 全局术语表
│
├── business/                         # 业务知识 (What & Why)
│   ├── _index.md                     # 业务知识入口
│   ├── overview/                     # 业务概览
│   │   ├── business-model.md         # 商业模式
│   │   ├── user-personas.md          # 用户画像
│   │   └── value-proposition.md      # 价值主张
│   │
│   ├── domains/                      # 领域知识 (按DDD聚合)
│   │   ├── _domain-map.md            # 领域全景图
│   │   ├── user/                     # 用户领域
│   │   │   ├── domain-model.md       # 领域模型
│   │   │   ├── business-rules.md     # 业务规则
│   │   │   ├── processes.md          # 业务流程
│   │   │   └── faq.md                # 常见问题
│   │   ├── lending/                  # 借贷领域
│   │   ├── staking/                  # 质押领域
│   │   ├── custody/                  # 托管领域
│   │   ├── rwa/                      # RWA领域
│   │   ├── bridge/                   # 桥接领域
│   │   ├── stablecoin/               # 稳定币领域
│   │   ├── tokenization/             # 代币化领域
│   │   └── compliance/               # 合规领域
│   │
│   ├── flows/                        # 跨域业务流程
│   │   ├── _flow-catalog.md          # 流程目录
│   │   ├── onramp-flow.md            # 入金流程
│   │   ├── offramp-flow.md           # 出金流程
│   │   ├── lending-liquidation.md    # 借贷清算流程
│   │   └── rwa-investment.md         # RWA投资流程
│   │
│   └── rules/                        # 业务规则库
│       ├── _rule-catalog.md          # 规则目录
│       ├── risk-rules.md             # 风控规则
│       ├── compliance-rules.md       # 合规规则
│       └── fee-rules.md              # 费用规则
│
├── architecture/                     # 架构知识 (How)
│   ├── _index.md                     # 架构知识入口
│   ├── overview/                     # 架构概览
│   │   ├── system-architecture.md    # 系统架构
│   │   ├── deployment.md             # 部署架构
│   │   └── security.md               # 安全架构
│   │
│   ├── services/                     # 服务知识
│   │   ├── _service-catalog.md       # 服务目录
│   │   ├── user-service/             # 用户服务
│   │   │   ├── overview.md           # 服务概览
│   │   │   ├── api-reference.md      # API参考
│   │   │   ├── data-model.md         # 数据模型
│   │   │   └── integration.md        # 集成说明
│   │   ├── lending-service/
│   │   └── ...
│   │
│   ├── integrations/                 # 集成知识
│   │   ├── internal-apis.md          # 内部API
│   │   ├── external-apis.md          # 外部API
│   │   └── events.md                 # 事件契约
│   │
│   └── standards/                    # 技术标准
│       ├── coding-standards.md       # 编码规范
│       ├── api-standards.md          # API规范
│       └── database-standards.md     # 数据库规范
│
├── operations/                       # 运营知识
│   ├── _index.md
│   ├── runbooks/                     # 运维手册
│   │   ├── incident-response.md      # 事件响应
│   │   └── troubleshooting.md        # 问题排查
│   └── configurations/               # 配置说明
│       ├── feature-flags.md          # 功能开关
│       └── rate-limits.md            # 限流配置
│
├── decisions/                        # 决策记录
│   ├── _index.md
│   ├── adr/                          # 架构决策
│   └── bdr/                          # 业务决策
│
└── ai-context/                       # AI专用上下文
    ├── system-prompts/               # 系统提示词
    │   ├── business-qa.md            # 业务问答提示词
    │   └── architecture-qa.md        # 架构问答提示词
    ├── examples/                     # 问答示例
    │   ├── business-qa-examples.md
    │   └── architecture-qa-examples.md
    └── knowledge-graph.md            # 知识图谱(概念关系)
```

### 2.2 入口文件设计

```markdown
<!-- INDEX.md - 知识库总入口 -->

# Web3金融平台知识库

## 快速导航

| 如果你想了解... | 请查阅 |
|----------------|--------|
| 平台做什么业务？ | [business/overview/business-model.md] |
| 某个业务领域的详情？ | [business/domains/_domain-map.md] |
| 一个完整业务流程？ | [business/flows/_flow-catalog.md] |
| 某条业务规则？ | [business/rules/_rule-catalog.md] |
| 系统架构设计？ | [architecture/overview/system-architecture.md] |
| 某个服务的API？ | [architecture/services/_service-catalog.md] |
| 技术规范标准？ | [architecture/standards/] |
| 运维排障指南？ | [operations/runbooks/] |

## 知识库元信息

- **最后更新**: 2024-01-15
- **版本**: v1.2.0
- **维护者**: 架构组
- **更新频率**: 业务知识(月度)、架构知识(季度)

## AI使用指南

当回答问题时，请按以下顺序查找：
1. 先查 GLOSSARY.md 确认术语定义
2. 根据问题类型定位到对应目录
3. 优先使用 _index.md 或 _catalog.md 导航
4. 深入具体文档获取详情
```

---

## 三、知识文档模板

### 3.1 领域知识模板

```markdown
<!-- business/domains/{domain}/domain-model.md -->

# {领域名称} 领域模型

## 元信息
- **领域**: {领域英文名}
- **负责团队**: {团队名}
- **最后更新**: {日期}
- **版本**: {版本号}

## 一句话描述
{用一句话说明这个领域是做什么的}

## 核心概念

### 聚合根
| 聚合根 | 定义 | 生命周期 |
|--------|------|----------|
| {名称} | {定义} | {创建→状态→终态} |

### 实体与值对象
| 名称 | 类型 | 说明 |
|------|------|------|
| {名称} | Entity/VO | {说明} |

### 状态机
```
{状态转换图}
```

## 核心业务流程

### {流程1名称}
**触发条件**: {什么情况下触发}
**参与角色**: {谁参与}
**步骤**:
1. {步骤1}
2. {步骤2}
...

**结果**: {成功/失败的结果}

## 业务规则

| 规则ID | 规则名称 | 规则描述 | 约束条件 |
|--------|----------|----------|----------|
| BR-001 | {名称} | {描述} | {条件} |

## 领域事件

| 事件 | 触发时机 | 携带数据 | 订阅者 |
|------|----------|----------|--------|
| {事件名} | {时机} | {数据} | {订阅服务} |

## 与其他领域的关系

### 上游依赖
- **{领域}**: {依赖说明}

### 下游消费
- **{领域}**: {提供什么}

## 常见问题 (FAQ)

### Q: {问题1}
A: {回答1}

### Q: {问题2}
A: {回答2}

## 变更历史
| 日期 | 版本 | 变更内容 | 变更人 |
|------|------|----------|--------|
```

### 3.2 业务流程模板

```markdown
<!-- business/flows/{flow-name}.md -->

# {流程名称}

## 元信息
- **流程ID**: FLOW-{编号}
- **涉及领域**: {领域列表}
- **最后更新**: {日期}

## 流程概述
{2-3句话描述这个流程是什么}

## 前置条件
- [ ] {条件1}
- [ ] {条件2}

## 流程图

```
┌────────┐    ┌────────┐    ┌────────┐
│ Step1  │───▶│ Step2  │───▶│ Step3  │
└────────┘    └────────┘    └────────┘
```

## 详细步骤

### Step 1: {步骤名称}
- **执行者**: {角色/服务}
- **输入**: {输入数据}
- **处理**: {处理逻辑}
- **输出**: {输出数据}
- **异常处理**: {异常情况及处理}

### Step 2: {步骤名称}
...

## 关键业务规则
| 步骤 | 规则 | 说明 |
|------|------|------|
| Step1 | {规则} | {说明} |

## 数据流

| 步骤 | 服务 | 数据变更 |
|------|------|----------|
| 1 | {服务} | {变更} |

## 异常场景

### 场景1: {异常描述}
- **触发条件**: {条件}
- **处理方式**: {处理}
- **用户影响**: {影响}

## 监控指标

| 指标 | 说明 | 阈值 |
|------|------|------|
| {指标名} | {说明} | {阈值} |

## 常见问题

### Q: {问题}
A: {回答}
```

### 3.3 API参考模板

```markdown
<!-- architecture/services/{service}/api-reference.md -->

# {服务名称} API参考

## 元信息
- **服务**: {服务名}
- **基础URL**: `https://api.example.com/v1/{service}`
- **认证方式**: Bearer Token
- **版本**: v1.2.0
- **最后更新**: {日期}

## API目录

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 创建{资源} | POST | /{resources} | {说明} |
| 查询{资源} | GET | /{resources}/{id} | {说明} |

---

## 接口详情

### POST /{resources} - 创建{资源}

**功能说明**: {详细说明}

**权限要求**: {所需权限}

**请求参数**:

| 参数 | 位置 | 类型 | 必填 | 说明 |
|------|------|------|------|------|
| {参数} | body | string | 是 | {说明} |

**请求示例**:
```json
{
  "field": "value"
}
```

**响应参数**:

| 参数 | 类型 | 说明 |
|------|------|------|
| code | string | 状态码 |
| data | object | 业务数据 |

**响应示例**:
```json
{
  "code": "0",
  "data": {...}
}
```

**错误码**:

| 错误码 | 说明 | 处理建议 |
|--------|------|----------|
| {错误码} | {说明} | {建议} |

---

## 公共说明

### 认证
{认证说明}

### 分页
{分页说明}

### 错误处理
{错误处理说明}
```

---

## 四、知识管理流程

### 4.1 知识生命周期

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        知识生命周期管理                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐  │
│  │  创建   │──▶│  评审   │──▶│  发布   │──▶│  维护   │──▶│  归档   │  │
│  │ Create  │   │ Review  │   │ Publish │   │ Maintain│   │ Archive │  │
│  └─────────┘   └─────────┘   └─────────┘   └─────────┘   └─────────┘  │
│       │             │             │             │             │         │
│       ▼             ▼             ▼             ▼             ▼         │
│   需求触发       质量检查      版本发布      定期更新      版本废弃     │
│   模板填写       同行评审      通知订阅      反馈收集      历史保留     │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.2 知识创建流程

```yaml
# 知识创建触发条件
triggers:
  - 新功能上线
  - 业务规则变更
  - 架构决策确定
  - 问题频繁被问及
  - 新人入职需求

# 创建流程
process:
  1_需求识别:
    - 确定知识类型 (业务/架构/运营)
    - 确定目标受众
    - 确定放置位置

  2_内容创作:
    - 选择对应模板
    - 填写必填字段
    - 补充可选内容
    - 添加示例和FAQ

  3_质量检查:
    - 结构完整性检查
    - 术语一致性检查
    - 链接有效性检查
    - AI可读性验证

  4_评审发布:
    - 领域专家评审
    - 修改完善
    - 合并发布
    - 更新索引
```

### 4.3 知识更新流程

```yaml
# 定期更新计划
update_schedule:
  稳定知识:
    频率: 年度
    内容: 领域模型、核心概念
    触发: 重大业务变更

  演进知识:
    频率: 季度
    内容: 业务流程、规则
    触发: 版本发布

  动态知识:
    频率: 月度/周度
    内容: 配置、FAQ
    触发: 反馈收集

# 更新流程
update_process:
  1_变更识别:
    sources:
      - 代码变更 (自动检测)
      - 需求文档
      - 问答反馈
      - 定期审计

  2_影响分析:
    - 识别受影响文档
    - 评估变更范围
    - 确定更新优先级

  3_内容更新:
    - 修改相关文档
    - 更新版本号和日期
    - 更新变更历史

  4_验证发布:
    - AI问答验证
    - 发布通知
    - 更新索引
```

### 4.4 知识质量管理

```yaml
# 质量检查清单
quality_checklist:
  结构完整性:
    - [ ] 包含所有必填章节
    - [ ] 元信息完整 (日期、版本、负责人)
    - [ ] 有明确的目录和导航

  内容准确性:
    - [ ] 与代码/系统一致
    - [ ] 术语使用标准化
    - [ ] 示例可实际运行

  AI友好性:
    - [ ] 结构化程度高
    - [ ] 上下文自包含
    - [ ] FAQ覆盖常见问题

  可维护性:
    - [ ] 避免硬编码值
    - [ ] 链接使用相对路径
    - [ ] 有变更历史记录

# 质量度量指标
quality_metrics:
  完整度:
    定义: 必填字段填写率
    目标: ">= 95%"

  准确度:
    定义: AI回答正确率
    目标: ">= 90%"
    验证方式: 定期抽检

  时效性:
    定义: 文档与代码同步率
    目标: "< 7天延迟"

  可用性:
    定义: 问题命中率
    目标: ">= 85%的问题能找到答案"
```

---

## 五、AI问答集成

### 5.1 知识检索策略

```yaml
# AI问答时的知识检索流程
retrieval_strategy:
  step1_问题分类:
    categories:
      - 概念解释: "什么是X"
      - 流程说明: "如何做X"
      - 规则查询: "X的规则是什么"
      - 问题排查: "X出错怎么办"
      - 最佳实践: "X的最佳做法"

  step2_定位文档:
    mapping:
      概念解释: "GLOSSARY.md → domains/{domain}/domain-model.md"
      流程说明: "flows/_flow-catalog.md → flows/{flow}.md"
      规则查询: "rules/_rule-catalog.md → rules/{category}.md"
      问题排查: "operations/runbooks/ → domains/{domain}/faq.md"
      最佳实践: "standards/ → ai-context/examples/"

  step3_上下文组装:
    - 相关文档内容
    - 术语定义
    - 关联知识链接
```

### 5.2 AI系统提示词

```markdown
<!-- ai-context/system-prompts/business-qa.md -->

# 业务问答系统提示词

## 角色定义
你是Web3金融平台的业务专家，负责回答关于平台业务的问题。

## 知识范围
- 业务领域: 用户、借贷、质押、托管、RWA、桥接、稳定币、代币化、合规
- 业务流程: 入金、出金、借款、清算、质押、赎回等
- 业务规则: 风控规则、合规规则、费用规则
- 不回答: 具体代码实现、运维操作、技术细节

## 回答原则
1. 优先使用知识库中的内容回答
2. 使用标准术语(参考GLOSSARY.md)
3. 复杂流程用步骤形式展示
4. 涉及规则时引用规则ID
5. 不确定时明确说明，不编造

## 回答格式
1. 先给出简短直接的答案
2. 再给出详细解释
3. 如有相关内容，给出参考链接
4. 如有常见误区，给出提醒

## 示例问答

Q: 什么是健康因子？
A: 健康因子(Health Factor)是借贷领域中衡量用户仓位安全程度的指标。

**定义**: 健康因子 = 抵押品价值 × 清算阈值 / 借款价值

**规则**:
- 健康因子 >= 1: 仓位安全
- 健康因子 < 1: 可被清算

**参考**: [business/domains/lending/domain-model.md]
```

### 5.3 问答示例库

```markdown
<!-- ai-context/examples/business-qa-examples.md -->

# 业务问答示例

## 概念类问题

### Q: 什么是LTV？
A: LTV(Loan-to-Value)是抵押借贷中的抵押率，表示可借金额与抵押品价值的比例。

例如，ETH的LTV是80%，意味着存入价值100美元的ETH，最多可借出80美元。

**注意**: LTV不等于清算阈值，清算阈值通常高于LTV 5-10%。

---

## 流程类问题

### Q: 用户如何入金？
A: 入金流程如下：

1. **创建入金订单**: 用户选择金额和支付方式
2. **合规检查**: 系统进行KYC和AML检查
3. **法币支付**: 用户完成银行转账
4. **确认到账**: 系统确认资金到账
5. **铸造稳定币**: 等额稳定币铸造到用户钱包

**耗时**: 通常1-3个工作日
**限额**: 单笔最高10万美元，需L2及以上KYC

---

## 规则类问题

### Q: 借贷的清算规则是什么？
A: 清算规则(规则ID: BR-LEND-001)：

| 条件 | 说明 |
|------|------|
| 触发条件 | 健康因子 < 1 |
| 清算比例 | 最多清算50%债务 |
| 清算奖励 | 5-10%(根据资产) |
| 清算人 | 任何人可执行 |

**保护机制**: 当健康因子 < 1.1 时，系统会发送预警通知。

---

## 排查类问题

### Q: 提现失败怎么办？
A: 提现失败常见原因和解决方案：

1. **余额不足**: 检查可用余额是否足够(含手续费)
2. **地址错误**: 确认提现地址格式和网络是否正确
3. **风控拦截**: 联系客服确认是否触发风控规则
4. **链上拥堵**: 等待网络恢复或提高Gas费

**查询状态**: 在"提现记录"中查看失败原因
**联系客服**: 提供订单号和错误信息
```

---

## 六、知识同步机制

### 6.1 代码-文档同步

```yaml
# 自动检测代码变更，触发文档更新提醒

sync_triggers:
  API变更:
    检测: OpenAPI/Swagger文件变更
    影响: architecture/services/{service}/api-reference.md
    动作: 创建Issue提醒更新

  领域模型变更:
    检测: Entity/Aggregate类变更
    影响: business/domains/{domain}/domain-model.md
    动作: 创建Issue提醒更新

  业务规则变更:
    检测: Rule/Validator类变更
    影响: business/rules/*.md
    动作: 创建Issue提醒更新

  配置变更:
    检测: application.yml变更
    影响: operations/configurations/*.md
    动作: 自动更新配置说明

# GitHub Action示例
# .github/workflows/doc-sync-check.yml
```

### 6.2 多仓库聚合

```yaml
# 从各服务仓库聚合知识到中心知识库

aggregation_strategy:
  sources:
    - repo: user-service
      files:
        - .knowledge/context.md → business/domains/user/
        - docs/api.md → architecture/services/user-service/

    - repo: lending-service
      files:
        - .knowledge/context.md → business/domains/lending/
        - docs/api.md → architecture/services/lending-service/

  schedule: "0 2 * * *"  # 每日凌晨2点

  process:
    1. 拉取各仓库最新文档
    2. 转换格式为统一模板
    3. 检测冲突和不一致
    4. 生成聚合报告
    5. 提交PR待审核
```

---

## 七、度量与改进

### 7.1 知识库健康度指标

```yaml
health_metrics:
  覆盖度:
    定义: 知识点覆盖率
    计算: 已文档化知识点 / 应文档化知识点
    目标: ">= 90%"

  时效性:
    定义: 文档新鲜度
    计算: 近90天更新的文档比例
    目标: ">= 70%"

  可用性:
    定义: AI问答成功率
    计算: 成功回答数 / 总问题数
    目标: ">= 85%"

  准确性:
    定义: 回答正确率
    计算: 正确回答数 / 抽检回答数
    目标: ">= 90%"

  满意度:
    定义: 用户反馈评分
    计算: 正面反馈 / 总反馈
    目标: ">= 80%"
```

### 7.2 持续改进流程

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        知识库持续改进闭环                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐                 │
│  │  收集   │──▶│  分析   │──▶│  改进   │──▶│  验证   │──┐              │
│  │ Collect │   │ Analyze │   │ Improve │   │ Verify  │  │              │
│  └─────────┘   └─────────┘   └─────────┘   └─────────┘  │              │
│       ▲                                                  │              │
│       └──────────────────────────────────────────────────┘              │
│                                                                          │
│  收集:                         分析:                                     │
│  - AI问答日志                  - 未命中问题分类                          │
│  - 用户反馈                    - 错误回答根因                            │
│  - 文档访问统计                - 高频问题识别                            │
│                                                                          │
│  改进:                         验证:                                     │
│  - 补充缺失知识                - 重新测试问答                            │
│  - 修正错误内容                - 用户满意度调研                          │
│  - 优化文档结构                - 健康度指标检查                          │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 7.3 月度Review清单

```markdown
## 知识库月度Review清单

### 1. 覆盖度检查
- [ ] 是否有新上线功能未文档化？
- [ ] 是否有新业务规则未记录？
- [ ] FAQ是否覆盖近期高频问题？

### 2. 时效性检查
- [ ] 超过90天未更新的文档列表
- [ ] 与代码不一致的文档列表
- [ ] 过期配置信息

### 3. 质量抽检
- [ ] 随机抽取10个问题测试AI回答
- [ ] 检查术语使用一致性
- [ ] 验证链接有效性

### 4. 反馈处理
- [ ] 处理本月用户反馈
- [ ] 分析未命中问题
- [ ] 更新FAQ

### 5. 改进计划
- [ ] 确定下月重点更新内容
- [ ] 分配负责人
- [ ] 设定完成时间
```

---

## 八、工具支持

### 8.1 推荐工具链

```yaml
编写工具:
  - VS Code + Markdown插件
  - Typora (所见即所得)
  - Draw.io (流程图)

版本管理:
  - Git + GitHub/GitLab
  - 分支策略: main(发布) + develop(开发)

质量检查:
  - markdownlint (格式检查)
  - link-checker (链接检查)
  - 自定义模板检查脚本

搜索检索:
  - 全文搜索: Algolia / Elasticsearch
  - 向量检索: Pinecone / Weaviate (RAG场景)

可视化:
  - Docusaurus / VitePress (文档站点)
  - Notion (协作编辑)
```

### 8.2 自动化脚本

```bash
#!/bin/bash
# scripts/knowledge-check.sh
# 知识库质量检查脚本

echo "=== 知识库质量检查 ==="

# 1. 检查必填字段
echo "检查必填字段..."
find docs-knowledge -name "*.md" -exec grep -L "## 元信息" {} \;

# 2. 检查链接有效性
echo "检查链接..."
npx markdown-link-check docs-knowledge/**/*.md

# 3. 检查最后更新时间
echo "检查过期文档..."
find docs-knowledge -name "*.md" -mtime +90 -print

# 4. 格式检查
echo "格式检查..."
npx markdownlint docs-knowledge/**/*.md

echo "=== 检查完成 ==="
```
