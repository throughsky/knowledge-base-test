# AI Coding 研发流程体系 - 汇报材料

**版本**: 1.0
**基于文档版本**: 2.8
**创建日期**: 2025-12-04
**适用场景**: 领导及同事汇报

---

## 目录

1. [项目背景与目标](#1-项目背景与目标)
2. [核心理念](#2-核心理念)
3. [流程重塑](#3-流程重塑)
4. [多级知识空间](#4-多级知识空间)
5. [统一工具链](#5-统一工具链)
6. [GitHub 生态全栈方案](#6-github-生态全栈方案)
7. [质量保障体系](#7-质量保障体系)
8. [实施路径](#8-实施路径)
9. [度量与优化](#9-度量与优化)
10. [风险与应对](#10-风险与应对)
11. [总结与展望](#11-总结与展望)

---

## 1. 项目背景与目标

### 1.1 为什么需要 AI Coding 研发流程体系？

随着 AI 编码工具（如 GitHub Copilot、Claude Code、Cursor 等）的快速发展，软件开发正在经历从"人工编码"到"AI 协同编码"的范式转变。然而，单纯引入 AI 工具并不能自动带来效率提升，反而可能导致：

| 问题                        | 表现                                                       | 影响                                         |
| --------------------------- | ---------------------------------------------------------- | -------------------------------------------- |
| **业务设计难度大**    | 团队成员对 Web3 不熟悉，依赖外部组件多，可能有隐藏依赖卡点 | 开发同学前置到产品角色有难度，设计耗时长     |
| **AI 过度联想不精准** | 生成超出需求范围的代码                                     | 功能蔓延、维护成本增加                       |
| **质量不可控**        | 缺乏统一标准约束 AI 输出                                   | 代码质量参差不齐                             |
| **知识碎片化**        | AI 无法获取项目上下文                                      | 生成代码与架构不一致，设计方案阶段就效率低下 |
| **人机职责模糊**      | 不清楚哪些任务交给 AI                                      | 效率低下、责任不清                           |

### 1.2 设计目标

本体系旨在建立一套**系统化的 AI (Coding) 研发方法论**，实现：

```
┌─────────────────────────────────────────────────────────────────┐
│                    AI Coding 研发流程体系目标                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐│
│  │   质量可控      │   │   效率提升      │   │   知识沉淀      ││
│  │   ─────────     │   │   ─────────     │   │   ─────────     ││
│  │ • 规范驱动      │   │ • AI 承担机械   │   │ • 三层知识架构  ││
│  │ • 测试先行      │   │   性工作        │   │ • 自动化文档    ││
│  │ • 架构合规      │   │ • 人类聚焦决策  │   │ • 决策可追溯    ││
│  └─────────────────┘   └─────────────────┘   └─────────────────┘│
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 1.3 关键成功要素

**技术层面**：

- 规范与测试的双重驱动确保质量
- 三层知识架构支撑 AI 理解上下文
- 统一工具链降低认知负担
- 数据驱动的持续优化

**组织层面**：

- 循序渐进的实施路径
- 质量第一的文化建设
- **架构治理流程**：制定架构治理组织、决策流程、评审机制和持续改进方法
- **架构基本法**：明确架构原则、底线约束、技术选型标准，作为全团队的共同契约

**策略原则**：

- AI 不是万能的，先强化我们能做的（架构、质量、约束要求、以及知识库建设）
- 保持跟随社区演进（Codebase、Sub-agent 模式等）

---

## 2. 核心理念

### 2.1 体系架构全景

```
┌─────────────────────────────────────────────────────────────────┐
│                    AI Coding 研发流程体系                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│   │  SDD 驱动   │ ←→ │  TDD 驱动   │ ←→ │  AI 协同    │        │
│   │  规范先行   │    │  测试先行   │    │  人机结对   │        │
│   └─────────────┘    └─────────────┘    └─────────────┘        │
│          ↑                  ↑                  ↑                │
│          └──────────────────┼──────────────────┘                │
│                             │                                   │
│   ┌─────────────────────────┴─────────────────────────┐        │
│   │              多级知识空间 + 统一工具链              │        │
│   │         L0 企业级 → L1 项目级 → L2 仓库级           │        │
│   └───────────────────────────────────────────────────┘        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 核心原则

| 原则               | 说明                         | 价值                              |
| ------------------ | ---------------------------- | --------------------------------- |
| **规范驱动** | 先有设计规范，后有代码实现   | AI 直接消费设计规范，避免过度实现 |
| **测试先行** | 先写测试定义行为，再生成实现 | 质量内建，减少返工                |
| **知识分层** | 企业→项目→仓库三层架构     | 自底向上聚合，AI 获取完整上下文   |
| **工具统一** | 统一的 AI 工具链和开发环境   | 降低认知负担，提升协作效率        |
| **持续改进** | 数据驱动的效能度量和优化     | 持续提升 AI 协作效果              |

### 2.3 D-R-O 人机协作框架

**委派-审查-掌控 (Delegate-Review-Own)** 框架明确人机职责边界：

```
┌─────────────────────────────────────────────────────────────────┐
│                委派-审查-掌控 (D-R-O) 框架                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐                                            │
│  │   委派 Delegate │  → AI 可独立完成的任务                      │
│  │   (交给 AI)     │    样板代码、初稿生成、模式应用              │
│  └────────┬────────┘                                            │
│           │                                                     │
│           ▼                                                     │
│  ┌─────────────────┐                                            │
│  │   审查 Review   │  → 人类验证 AI 产出                         │
│  │   (人类把关)    │    准确性、完整性、合规性检查                │
│  └────────┬────────┘                                            │
│           │                                                     │
│           ▼                                                     │
│  ┌─────────────────┐                                            │
│  │   掌控 Own      │  → 人类必须负责的决策                       │
│  │   (人类主导)    │    战略方向、架构决策、最终审批              │
│  └─────────────────┘                                            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**各阶段职责分工**：

| SDLC 阶段      | 委派 (AI)                  | 审查 (人类)    | 掌控 (人类)          |
| -------------- | -------------------------- | -------------- | -------------------- |
| **规划** | 可行性分析初稿、依赖识别   | 验证估算准确性 | 优先级决策、资源分配 |
| **设计** | 原型搭建、样板代码         | 组件规范合规   | 设计系统、架构决策   |
| **构建** | 功能实现初稿、测试生成     | 性能、安全评估 | 跨切面架构决策       |
| **测试** | 测试用例生成、边缘情况识别 | 验证断言有效性 | 测试策略             |
| **审查** | 代码风格检查、安全扫描     | 架构一致性     | 最终合并决策         |
| **文档** | 模块摘要、API 描述         | 准确性验证     | 文档策略             |
| **运维** | 日志分析、修复建议         | 根因确认       | 敏感操作签署         |

**核心原则**：

- AI 是第一轮实施者，人类是审阅者和方向来源
- 机械性工作委派，创造性决策掌控
- 可逆操作委派，不可逆操作掌控

---

## 3. 流程重塑

### 3.1 SDD 规范驱动开发【核心创新】

#### 3.1.1 设计先行原则

SDD 的核心理念是**"设计即约束"**——通过清晰的功能规格文档约束 AI 的代码生成行为，避免过度实现和功能蔓延。

**功能规格文档结构**：

```markdown
# 功能规格: [功能名称]

## 1. 需求详细说明
- 业务背景、用户故事、验收标准

## 2. 技术设计文档
- 架构设计、数据模型、接口定义

## 3. 接口契约
- API 规范、请求/响应示例、错误码

## 4. 约束条件（关键！）
- 技术栈限定
- 代码行数控制
- 排除功能清单
```

#### 3.1.2 SDD 工作流程

基于 SpecKit 的标准化工作流：

```
┌──────────────────────────────────────────────────────────────┐
│                    SDD 工作流程                               │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐        │
│  │   specify   │ → │    plan     │ → │    tasks    │        │
│  │  自然语言   │   │  实施计划   │   │  可执行任务  │        │
│  │  → 功能规格 │   │  → 设计文档 │   │  → 任务列表  │        │
│  └─────────────┘   └─────────────┘   └─────────────┘        │
│                                              ↓               │
│                    ┌─────────────┐   ┌─────────────┐        │
│                    │   archive   │ ← │  implement  │        │
│                    │  知识沉淀   │   │  任务→代码  │        │
│                    └─────────────┘   └─────────────┘        │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

**工作流命令**：

| 命令                   | 功能         | 输入         | 输出               |
| ---------------------- | ------------ | ------------ | ------------------ |
| `/speckit.specify`   | 创建功能规格 | 自然语言描述 | spec.md            |
| `/speckit.plan`      | 生成实施计划 | spec.md      | plan.md            |
| `/speckit.tasks`     | 生成任务列表 | plan.md      | tasks.md           |
| `/speckit.implement` | 执行代码实现 | tasks.md     | 代码文件           |
| `/speckit.archive`   | 知识沉淀归档 | 已实现功能   | registry.json, ADR |

#### 3.1.3 架构合规检查

在 plan 阶段强制执行架构合规检查，确保设计符合企业架构原则：

| 原则            | 检查项               | 严重级别 |
| --------------- | -------------------- | -------- |
| I. TDD          | 测试策略、覆盖率目标 | CRITICAL |
| III. 微服务架构 | 分层结构、技术栈合规 | CRITICAL |
| IV. 安全优先    | 输入校验、审计日志   | CRITICAL |
| V. RESTful      | API 设计规范         | HIGH     |
| VI. 生产就绪    | 错误处理、事务管理   | HIGH     |
| VIII. 简洁性    | YAGNI、依赖管理      | MEDIUM   |

#### 3.1.4 知识生命周期管理

**解决问题**：SpecKit 生成的文档存在"一次性使用"问题，导致历史决策丢失。

**Feature Registry（特性注册表）**：

```json
{
  "features": [{
    "id": "user-authentication",
    "name": "用户认证系统",
    "status": "implemented",
    "summary": {
      "business_goal": "实现安全的用户登录",
      "technical_approach": "JWT + OAuth2.0",
      "key_decisions": ["使用 JWT 而非 Session"]
    },
    "impact": {
      "modules_created": ["auth-service"],
      "apis_added": ["/api/v1/auth/login"]
    },
    "adr_refs": ["ADR-001-jwt-token-strategy"]
  }]
}
```

**价值**：

- 历史决策可追溯
- 跨需求信息关联
- 避免重复设计和决策冲突

### 3.2 TDD 测试驱动开发【核心】

#### 3.2.1 TDD 三定律

1. 在编写失败的测试之前，不允许编写任何生产代码
2. 只允许编写刚好能够导致失败的测试代码
3. 只允许编写刚好能够使测试通过的生产代码

#### 3.2.2 红灯-绿灯-重构循环

```
    ┌──────────────────────────────────────────┐
    │                                          │
    ▼                                          │
┌────────┐      ┌────────┐      ┌────────┐    │
│ 红灯   │  →   │ 绿灯   │  →   │ 重构   │ ───┘
│ (失败) │      │ (通过) │      │ (优化) │
└────────┘      └────────┘      └────────┘
  写测试          写代码          改进代码
  定义行为        通过测试        保持测试通过
```

#### 3.2.3 AI 优先 TDD 流程

```
┌─────────────────────────────────────────────────────────────────┐
│                    AI 优先 TDD 流程                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Step 1: 人类定义测试策略                                        │
│  ─────────────────────────                                      │
│  • 定义核心场景和边界条件                                        │
│  • 确定测试粒度和覆盖率目标                                      │
│                                                                 │
│  Step 2: AI 生成测试用例                                         │
│  ─────────────────────────                                      │
│  • 根据规格生成单元测试                                          │
│  • 生成边界条件和异常场景                                        │
│                                                                 │
│  Step 3: 人类审查测试                                            │
│  ─────────────────────────                                      │
│  • 验证测试覆盖业务意图                                          │
│  • 确保断言有效（非"永远通过"的假测试）                          │
│                                                                 │
│  Step 4: AI 生成实现代码                                         │
│  ─────────────────────────                                      │
│  • 以通过测试为目标生成代码                                      │
│  • 避免过度实现                                                  │
│                                                                 │
│  Step 5: 人类验收重构                                            │
│  ─────────────────────────                                      │
│  • 代码审查、性能优化                                            │
│  • 架构调整（保持测试通过）                                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 3.2.4 测试金字塔

```
           ╱╲
          ╱  ╲
         ╱ E2E╲         10% - 端到端测试
        ╱──────╲        （关键路径）
       ╱        ╲
      ╱ 集成测试 ╲       20% - 服务/组件集成
     ╱────────────╲
    ╱              ╲
   ╱   单元测试     ╲    70% - 快速、隔离
  ╱──────────────────╲
```

### 3.3 Code Review 双层机制

#### 第一层：AI 自动化审查

| 检查类型 | 工具             | 输出           |
| -------- | ---------------- | -------------- |
| 代码风格 | ESLint, Prettier | 自动修复或警告 |
| 潜在 Bug | SonarQube        | 问题列表       |
| 安全漏洞 | GHAS, Snyk       | 安全警报       |
| 测试覆盖 | Jest, pytest     | 覆盖率报告     |

#### 第二层：人工审查

| 审查维度   | 关注点                 |
| ---------- | ---------------------- |
| 架构一致性 | 是否符合项目架构模式   |
| 业务逻辑   | 是否正确实现业务需求   |
| 可维护性   | 代码可读性、抽象合理性 |
| 性能考量   | 是否存在性能隐患       |

---

## 4. 多级知识空间

### 4.1 核心理念

多级知识空间的设计遵循两大核心理念：

```
┌─────────────────────────────────────────────────────────────────┐
│                 多级知识空间核心理念                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  理念一：L2 仓库级 — AI 自动化优先                         │  │
│  │  ─────────────────────────────────────────────────────────  │  │
│  │  • 仓库级知识库尽量依靠 AI 自动化生成                       │  │
│  │  • 降低开发同学的文档维护负担                               │  │
│  │  • 代码变更自动触发文档更新（CodeWiki）                     │  │
│  │  • 开发者只需维护核心决策文档（context.md, decisions.md）   │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  理念二：L1 项目级 — 业务领域枢纽                          │  │
│  │  ─────────────────────────────────────────────────────────  │  │
│  │                                                             │  │
│  │  向内：串联仓库，指导开发                                   │  │
│  │  ┌─────────┐    ┌─────────┐    ┌─────────┐                │  │
│  │  │ 仓库 A  │ ←─ │   L1    │ ─→ │ 仓库 B  │                │  │
│  │  └─────────┘    │ 项目级  │    └─────────┘                │  │
│  │                 │ 知识库  │                                │  │
│  │  ┌─────────┐    │         │    ┌─────────┐                │  │
│  │  │ 仓库 C  │ ←─ │         │ ─→ │ 仓库 D  │                │  │
│  │  └─────────┘    └─────────┘    └─────────┘                │  │
│  │                      ↓                                      │  │
│  │  向外：开放 API，指导跨业务对接                             │  │
│  │  ┌─────────────────────────────────────────────────────┐   │  │
│  │  │ • 对外 API 规范：接口定义、数据契约、版本策略        │   │  │
│  │  │ • 跨业务对接指南：集成模式、认证方式、错误处理       │   │  │
│  │  │ • 业务流程设计：上下游依赖、事件定义、编排规范       │   │  │
│  │  └─────────────────────────────────────────────────────┘   │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**理念价值总结**：

| 层级                | 核心理念      | 维护主体            | 受众                  |
| ------------------- | ------------- | ------------------- | --------------------- |
| **L2 仓库级** | AI 自动化优先 | AI 生成 + 少量人工  | 仓库内开发者          |
| **L1 项目级** | 业务领域枢纽  | 架构师 + 技术负责人 | 内部仓库 + 外部业务方 |
| **L0 企业级** | 底线约束      | 架构委员会          | 全团队                |

**L1 项目级知识库的延伸价值**：

> 💡 **重要说明**：L1 项目级知识库不仅仅服务于 AI Coding 场景，我们期望它能成为团队的**智能知识中枢**。

| 延伸场景                  | 价值说明                                                                              | 对标产品            |
| ------------------------- | ------------------------------------------------------------------------------------- | ------------------- |
| **AI 辅助业务设计** | 类似 NotebookLM、Youmind 等知识库产品，通过 AI 问答方式降低大家设计业务方案的认知负担 | NotebookLM, Youmind |
| **架构设计参考**    | 承载项目的架构决策、技术选型、设计模式等，降低团队沟通成本，新人快速上手              | 内部 Wiki           |
| **跨团队协作基础**  | 统一的领域术语、API 规范、业务流程定义，减少跨团队对齐成本                            | -                   |

⚠️ **维护成本说明**：与 L2 仓库级（AI 自动化）不同，L1 项目级知识库**需要团队手工维护**。这是因为：

- 业务领域知识难以从代码自动提取
- 架构决策的背景和权衡需要人工记录
- 对外 API 规范需要人工评审和版本管理

建议由**架构师或技术负责人**主导维护，定期 Review 更新，**这个维护周期和策略要执行到位**。

### 4.2 三层架构体系

```
┌─────────────────────────────────────────────────────────────────┐
│                       多级知识空间架构                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                    L0 企业级知识库                         │  │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐         │  │
│  │  │ 架构原则    │ │ 安全规范    │ │ 治理流程    │         │  │
│  │  │ (不可覆盖)  │ │ (不可覆盖)  │ │ (不可覆盖)  │         │  │
│  │  └─────────────┘ └─────────────┘ └─────────────┘         │  │
│  └───────────────────────────────────────────────────────────┘  │
│                              ↓ 继承                             │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                    L1 项目级知识库                         │  │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐         │  │
│  │  │ 技术栈规范  │ │ 编码规范    │ │ 领域模型    │         │  │
│  │  │ (可部分覆盖)│ │ (可部分覆盖)│ │ (可部分覆盖)│         │  │
│  │  └─────────────┘ └─────────────┘ └─────────────┘         │  │
│  └───────────────────────────────────────────────────────────┘  │
│                              ↓ 继承                             │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                    L2 仓库级知识库                         │  │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐         │  │
│  │  │ context.md  │ │ module docs │ │ decisions   │         │  │
│  │  │ (AI 自动生成)│ │ (AI 自动生成)│ │ (人工维护)  │         │  │
│  │  └─────────────┘ └─────────────┘ └─────────────┘         │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```


### 4.3 L0 企业级约束规范（不可覆盖）

#### 4.3.1 安全与合规约束

| 约束类别 | 具体要求                 | 强制级别 |
| -------- | ------------------------ | -------- |
| 认证机制 | 统一认证网关、Token 规范 | 必须遵守 |
| 输入校验 | 白名单验证、SQL 注入防护 | 必须遵守 |
| 数据保护 | 加密存储、脱敏显示       | 必须遵守 |
| 审计日志 | 关键操作留痕、日志格式   | 必须遵守 |

#### 4.3.2 架构底线约束

| 约束类别   | 具体要求                      |
| ---------- | ----------------------------- |
| 分层架构   | Controller-Service-Repository |
| 数据一致性 | 事务边界、最终一致性          |
| 可观测性   | 日志、指标、链路追踪          |
| 韧性设计   | 超时、重试、熔断              |

#### 4.3.3 AI Coding 企业级约束

| 约束         | 说明                      |
| ------------ | ------------------------- |
| 禁止敏感信息 | 不得将密钥、密码发送给 AI |
| 代码审查必须 | AI 生成代码必须人工审查   |
| 安全扫描必须 | AI 代码必须通过安全扫描   |
| 采纳率统计   | 记录 AI 代码采纳情况      |

### 4.4 L1 项目级约束规范（可部分覆盖）

#### 4.4.1 技术栈规范

```yaml
# tech-stack.md 示例
languages:
  backend: Java 17+
  frontend: TypeScript 5.x

frameworks:
  backend: Spring Boot 3.x
  frontend: React 18 + Next.js 14

databases:
  primary: PostgreSQL 15
  cache: Redis 7.x

# 可覆盖项
overridable:
  - testing_framework  # 允许项目选择 JUnit/TestNG
  - orm_framework      # 允许选择 JPA/MyBatis
```

#### 4.4.2 编码规范

| 规范类别 | 内容                     |
| -------- | ------------------------ |
| 命名规范 | 类名、方法名、变量名约定 |
| 代码风格 | 缩进、括号、换行规则     |
| 注释规范 | 文档注释、行内注释要求   |
| 异常处理 | 异常分类、处理策略       |

#### 4.4.3 领域模型与术语

```yaml
# glossary.md - 领域术语表
entities:
  User:
    definition: "系统注册用户"
    attributes: [id, name, email, status]

  Order:
    definition: "用户订单"
    states: [pending, paid, shipped, completed]

# AI 使用这些术语保持一致性
```

### 4.5 L2 仓库级知识库

#### 4.5.1 目录结构

```
{repo}/
├── CLAUDE.md                    # AI 入口配置
└── .knowledge/
    ├── context.md               # 仓库上下文（人工维护）
    ├── decisions.md             # 设计决策（人工维护）
    ├── upstream/                # 上级知识库（Git Subtree）
    │   ├── L1-project/          # 项目级知识
    │   └── L0-enterprise/       # 企业级知识
    ├── features/                # 功能规格归档
    │   ├── registry.json        # 特性注册表
    │   └── {feature}/           # 各功能文档
    └── code-derived/            # AI 自动生成
        ├── overview.md          # 仓库概览
        ├── module_tree.json     # 模块树
        └── {module}.md          # 模块文档
```

#### 4.5.2 CodeWiki 自动生成

**CodeWiki** 是 AI 自动文档生成工具，解决"代码变更后文档滞后"问题：

```
┌─────────────────────────────────────────────────────────────────┐
│                    CodeWiki 工作流程                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  代码仓库                                                        │
│     ↓                                                           │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐           │
│  │ 依赖分析    │ → │ 模块聚类    │ → │ 拓扑排序    │           │
│  │ Tree-sitter │   │ 调用图构建  │   │ 渐进生成    │           │
│  └─────────────┘   └─────────────┘   └─────────────┘           │
│                                              ↓                  │
│                                      ┌─────────────┐           │
│                                      │ AI 文档生成 │           │
│                                      │ LLM 调用    │           │
│                                      └─────────────┘           │
│                                              ↓                  │
│  输出: overview.md, module_tree.json, {module}.md              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 4.5.3 Git Subtree 知识库集成

**方案选型**：

| 方案                  | AI 友好性                | 操作复杂度     | 推荐场景            |
| --------------------- | ------------------------ | -------------- | ------------------- |
| Git Submodule         | 低（需 init）            | 中             | 独立版本控制        |
| **Git Subtree** | **高（直接可读）** | **低**   | **AI Coding** |
| 文件复制              | 高                       | 高（手动同步） | 不推荐              |

**配置示例**：

```yaml
# .knowledge-config.yaml
version: "1.0"
repo_level: L2

upstream:
  L1-project:
    remote: git@github.com:org/project-knowledge.git
    prefix: .knowledge/upstream/L1-project
  L0-enterprise:
    remote: git@github.com:org/enterprise-knowledge.git
    prefix: .knowledge/upstream/L0-enterprise

search_priority:
  - .knowledge/context.md
  - .knowledge/code-derived/
  - .knowledge/upstream/L1-project/
  - .knowledge/upstream/L0-enterprise/

inheritance:
  readonly: [security-policies, architecture-principles]
  overridable: [coding-standards, api-conventions]
```

### 4.6 L0/L1 约束分层总结

| 维度           | L0 企业级（不可覆盖）  | L1 项目级（可部分覆盖） |
| -------------- | ---------------------- | ----------------------- |
| **安全** | 认证、加密、审计、合规 | 项目特定安全配置        |
| **架构** | 分层、一致性、可观测性 | 技术栈选型、框架配置    |
| **治理** | 审查流程、发布规范     | 项目分支策略、发布节奏  |
| **编码** | 通用安全编码规范       | 项目命名、风格约定      |
| **AI**   | 敏感信息保护、审查必须 | 项目 Prompt 模板、指导  |

---

## 5. 统一工具链

### 5.1 AI 编码工具

#### 5.1.1 核心 IDE 和 Agent

| 工具                           | 定位          | 适用场景     |
| ------------------------------ | ------------- | ------------ |
| **Cursor**               | AI-First IDE  | 主力开发环境 |
| **VS Code +Claude Code** | 传统 IDE + AI | 兼容性场景   |
| **Claude Code**          | CLI Agent     | 复杂任务编排 |

#### 5.1.2 Agent 架构

```
┌─────────────────────────────────────────────────────────────────┐
│                    Agent 架构                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                     用户指令                             │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   Agent 协调层                           │   │
│  │  • 任务分解    • 上下文管理    • 工具选择               │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
│  │ 文件操作 │  │ 代码分析 │  │ 终端执行 │  │ 知识检索 │       │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘       │
│                              ↓                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   LLM 推理层                             │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 MCP (Model Context Protocol) 集成

| MCP 服务器 | 功能                 | 用途     |
| ---------- | -------------------- | -------- |
| GitHub MCP | 仓库、Issue、PR 操作 | 代码管理 |
| Sentry MCP | 错误追踪             | 问题排查 |
| Figma MCP  | 设计稿访问           | 前端开发 |
| Context7   | 文档检索             | 知识获取 |
| Playwright | 浏览器自动化         | E2E 测试 |

### 5.3 代码理解能力

```
┌─────────────────────────────────────────────────────────────────┐
│                    代码分析技术栈                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    代码仓库                              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 解析层                                                    │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐               │  │
│  │  │Tree-sitter│  │   LSP   │  │ AST 分析 │               │  │
│  │  │ 多语言解析│  │ 语义理解 │  │ 依赖提取 │               │  │
│  │  └──────────┘  └──────────┘  └──────────┘               │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              ↓                                  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 分析层                                                    │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐               │  │
│  │  │ 调用图   │  │ 依赖图   │  │ 模块聚类 │               │  │
│  │  └──────────┘  └──────────┘  └──────────┘               │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              ↓                                  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 输出层                                                    │  │
│  │  • 模块文档    • 依赖关系    • 复杂度报告                │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 5.4 质量工具链

| 工具类别           | 工具              | 用途         |
| ------------------ | ----------------- | ------------ |
| **静态分析** | SonarQube, ESLint | 代码质量检查 |
| **安全扫描** | GHAS, Snyk        | 漏洞检测     |
| **测试覆盖** | Jest, pytest      | 覆盖率统计   |
| **依赖检查** | Dependabot        | 依赖更新     |

---

## 6. GitHub 生态全栈方案

### 6.1 技术栈全景

```
┌─────────────────────────────────────────────────────────────────┐
│                 GitHub 生态全栈技术栈                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  规划层: GitHub Projects + Issues                        │   │
│  │  • 需求管理   • 看板视图   • 自动化规则                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  开发层: GitHub Copilot 家族                             │   │
│  │  • Copilot      → 代码补全                               │   │
│  │  • Copilot Chat → 对话式编程                             │   │
│  │  • Workspace    → 任务驱动开发                           │   │
│  │  • Coding Agent → 自主编码代理                           │   │
│  │  • Agent HQ     → 多 Agent 编排                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  交付层: GitHub Actions                                  │   │
│  │  • CI/CD 流水线   • 自动化测试   • 部署编排              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  安全层: GitHub Advanced Security (GHAS)                 │   │
│  │  • 代码扫描   • Secret 检测   • 依赖审计                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2 Copilot 产品矩阵

| 产品                        | 能力          | 适用场景       |
| --------------------------- | ------------- | -------------- |
| **Copilot**           | 代码补全      | 日常编码       |
| **Copilot Chat**      | 对话式编程    | 代码解释、调试 |
| **Copilot Workspace** | 任务驱动开发  | Issue → 代码  |
| **Coding Agent**      | 自主编码代理  | 复杂功能实现   |
| **Agent HQ**          | 多 Agent 编排 | 大规模任务     |

### 6.3 与 AI Coding 流程体系集成

| 流程阶段              | GitHub 工具       | 集成方式     |
| --------------------- | ----------------- | ------------ |
| **SDD specify** | Issue 模板        | 规格即 Issue |
| **SDD plan**    | Copilot Workspace | AI 生成计划  |
| **TDD**         | Copilot           | 测试生成     |
| **Code Review** | Copilot Review    | AI 预审      |
| **CI/CD**       | Actions           | 自动化流水线 |
| **安全**        | GHAS              | 自动扫描     |

### 6.4 推荐方案

#### 按团队规模选型

| 团队规模                     | 推荐方案 | 关键组件                     |
| ---------------------------- | -------- | ---------------------------- |
| **小型团队 (< 10人)**  | 精简版   | Copilot + Actions + Projects |
| **中型团队 (10-50人)** | 标准版   | + Copilot Workspace + GHAS   |
| **大型团队 (> 50人)**  | 企业版   | + Agent HQ + 多仓库协调      |

---

## 7. 质量保障体系

### 7.1 SDD 质量门禁

| 检查点         | 要求             | 阻断级别 |
| -------------- | ---------------- | -------- |
| spec.md 完整性 | 必须包含验收标准 | 阻断     |
| 架构合规检查   | 九大原则合规     | 阻断     |
| plan.md 可行性 | 技术方案可实施   | 警告     |

### 7.2 TDD 质量门禁

| 检查点       | 要求          | 阻断级别 |
| ------------ | ------------- | -------- |
| 测试覆盖率   | ≥ 80%        | 阻断     |
| 测试有效性   | 无假测试      | 阻断     |
| 测试先于实现 | 红灯-绿灯顺序 | 警告     |

### 7.3 代码质量门禁

| 检查点   | 要求                 | 阻断级别 |
| -------- | -------------------- | -------- |
| 静态分析 | SonarQube 无阻断问题 | 阻断     |
| 安全扫描 | 无高危漏洞           | 阻断     |
| 代码风格 | 通过 Linter 检查     | 阻断     |

### 7.4 Agent 评测体系

#### 评测指标

| 指标                 | 定义                | 目标  |
| -------------------- | ------------------- | ----- |
| **代码采纳率** | 采纳代码 / 生成代码 | > 70% |
| **一次通过率** | 首次生成即可用      | > 50% |
| **修改量**     | 人工修改行数        | < 20% |
| **规格一致性** | 代码符合规格比例    | > 90% |

---

## 8. 实施路径

### 8.1 四阶段实施计划

#### 阶段一：基础构建

> 🎯 **目标**：基础设施就绪，试点验证

- 知识库构建（L0/L1/L2 框架搭建），**知识目录和文档定义（内容较多，任务较多)**
- 架构基本法和约束规范制定
- CodeWiki 集成，实现 L2 自动化，以及L1聚合L2的功能
- 试点验证，A/B Test 效果对比
- SDD/TDD 与知识库结合的使用方式
- 统一的公共基础架构

#### 阶段二：流程落地

> 🎯 **目标**：核心流程运转

- 知识库大规模收集实践
- 设计阶段使用 AI（AI 辅助业务设计）
- 测试阶段使用 AI（TDD 流程）
- Code Review 机制（双层审查）
- 开发特定 Sub-agent、Skills 等定制功能，提升使用便捷性，通过github特性考虑更多自动化链路集成。

#### 阶段三：规模推广

> 🎯 **目标**：全面覆盖

- 全团队覆盖
- 效能数据分析
- 最佳实践沉淀

#### 阶段四：持续优化

> 🎯 **目标**：持续改进

- 度量驱动优化
- 工具链升级
- 知识库演进

### 8.2 各阶段目标

| 阶段                       | 目标                   | 交付物                                               |
| -------------------------- | ---------------------- | ---------------------------------------------------- |
| **阶段一：基础构建** | 基础设施就绪，试点验证 | 知识库框架、架构基本法、CodeWiki 集成、公共基础架构  |
| **阶段二：流程落地** | 核心流程运转           | 知识库大规模实践、AI 辅助设计/测试、Code Review 机制 |
| **阶段三：规模推广** | 全面覆盖               | 全团队覆盖、效能报告、最佳实践沉淀                   |
| **阶段四：持续优化** | 持续改进               | 度量驱动优化、工具链升级、知识库演进                 |

---

## 9. 度量与优化

### 9.1 SDD/TDD 效能指标

| 指标       | 定义             | 目标  |
| ---------- | ---------------- | ----- |
| 规格一致性 | 实现符合规格比例 | > 95% |
| 测试覆盖率 | 代码覆盖率       | > 80% |
| 缺陷逃逸率 | 测试后发现缺陷   | < 5%  |

### 9.2 AI 协作指标

| 指标       | 定义              | 目标  |
| ---------- | ----------------- | ----- |
| 代码采纳率 | AI 代码被采纳比例 | > 70% |
| 审查修改率 | 人工修改比例      | < 20% |
| 首次通过率 | 无需修改直接使用  | > 50% |

### 9.3 知识库健康指标

| 指标       | 定义           | 目标  |
| ---------- | -------------- | ----- |
| 文档覆盖率 | 模块文档覆盖   | > 90% |
| 更新时效性 | 代码变更后更新 | < 24h |
| 引用准确率 | AI 引用正确率  | > 95% |

### 9.4 综合效能指标

| 指标         | 定义            | 目标      |
| ------------ | --------------- | --------- |
| 交付周期     | 需求到上线时间  | 缩短 30%  |
| 缺陷密度     | 缺陷数/千行代码 | 降低 40%  |
| 开发者满意度 | 工具使用满意度  | > 4.0/5.0 |

---

## 10. 风险与应对

### ⚠️ 核心风险总结

在推进 AI Coding 研发流程体系过程中，需要重点关注以下核心风险：

| 核心风险                             | 风险描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 影响                                  |
| ------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------- |
| **知识库建设效果不达预期**     | 自动构建知识库效果欠佳，或知识库维护不力，导致知识库作用不大，AI 无法获取有效上下文                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 整个体系基础动摇，AI 辅助效果大打折扣 |
| **业务复杂度与团队现状的挑战** | **① 0-1 阶段全貌不清**：MVP 具体设计的功能点和模块缺乏整体依赖关系，可能存在关键人或功能隐形卡点，甚至工作量评估不合理<br />**② MVP 范围与人力匹配**：功能铺面可能过大，需提前评估单小组能否完成，必要时多小组协作<br />**③ 开发转型困难**：纯开发同学现状，业务不熟悉、外部接口依赖多，方案设计环节 AI 使用率偏低或者碎片化<br />**④ 动态调整需求**：需建立人员动态调整和风险提前暴露机制<br />**⑤ AI 架构设计局限**：AI 的架构设计偏 common sense，真实业务场景架构设计可能不合理，**每个小组仍需有人负责技术架构 Review** | 推进 AI 小组化协作模式可能受阻        |
| **人力资源紧张**               | 当前团队人力紧张，难以抽出足够精力进行知识库建设，因为要求知识目录和具体内容等都要实实在在去落地。以及配合SDD和设计流程                                                                                                                                                                                                                                                                                                                                                                                                                                               | 实施进度延缓，试点效果难以保证        |

> 💡 **应对策略**：采用渐进式实施，优先在成熟模块试点；L2 仓库级尽量自动化降低维护负担；L1 项目级知识库作为业务设计辅助工具，反向帮助团队理解业务全貌。

### 10.1 技术风险

| 风险                  | 概率 | 影响 | 应对措施               |
| --------------------- | ---- | ---- | ---------------------- |
| AI 生成代码质量不稳定 | 高   | 中   | 多层审查机制、质量门禁 |
| 知识库维护成本高      | 中   | 中   | L2 自动化、CodeWiki    |
| 工具链学习曲线陡峭    | 中   | 中   | 渐进式培训、文档完善   |

### 10.2 管理风险

| 风险           | 概率 | 影响 | 应对措施           |
| -------------- | ---- | ---- | ------------------ |
| 流程执行不到位 | 高   | 高   | 门禁强制、定期审计 |
| 团队抵触变革   | 中   | 高   | 价值宣导、试点先行 |
| 投入产出不明确 | 中   | 中   | 效能度量、数据驱动 |

### 10.3 组织风险

| 风险         | 概率 | 影响 | 应对措施               |
| ------------ | ---- | ---- | ---------------------- |
| 技能转型困难 | 中   | 高   | 培训体系、结对编程     |
| 过度依赖 AI  | 中   | 高   | D-R-O 框架、人类掌控   |
| 知识产权风险 | 低   | 高   | 合规审查、敏感信息保护 |

---

## 11. 总结与展望

### 11.1 核心价值总结

| 维度             | 当前痛点       | 体系价值                      |
| ---------------- | -------------- | ----------------------------- |
| **质量**   | AI 输出不可控  | 规范+测试双驱动，质量内建     |
| **效率**   | 重复性工作多   | AI 承担机械工作，人类聚焦决策 |
| **一致性** | 标准难以落地   | 多级知识空间，约束自动继承    |
| **可追溯** | 决策历史丢失   | Feature Registry + ADR        |
| **低负担** | 文档维护成本高 | L2 自动生成，减少维护         |

### 11.2 预期收益

```
┌─────────────────────────────────────────────────────────────────┐
│                    预期收益                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐│
│  │  交付效率       │   │  代码质量       │   │  开发体验       ││
│  │  ─────────      │   │  ─────────      │   │  ─────────      ││
│  │  周期缩短 30%   │   │  缺陷降低 40%   │   │  满意度 > 4.0   ││
│  │  AI 采纳率 70%+ │   │  覆盖率 80%+    │   │  认知负担降低   ││
│  └─────────────────┘   └─────────────────┘   └─────────────────┘│
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 11.3 下一步计划

1. **启动试点**：选择 1-2 个项目进行试点验证
2. **知识库建设**：优先构建 L0 企业级知识库
3. **工具链部署**：统一 AI 编码工具和环境
4. **培训赋能**：开展 SDD/TDD 培训
5. **效能度量**：建立度量体系，数据驱动优化

---

## 附录：快速参考卡片

### A. SDD 工作流速查

```
specify → plan → tasks → implement → archive
   ↓        ↓       ↓         ↓          ↓
 规格     计划    任务      代码       沉淀
```

### B. D-R-O 决策速查

| 任务类型           | 分配     |
| ------------------ | -------- |
| 样板代码、初稿生成 | 委派 AI  |
| 质量验证、合规检查 | 人类审查 |
| 架构决策、战略方向 | 人类掌控 |

### C. 知识层级速查

| 层级 | 定位   | 可覆盖性   |
| ---- | ------ | ---------- |
| L0   | 企业级 | 不可覆盖   |
| L1   | 项目级 | 可部分覆盖 |
| L2   | 仓库级 | 完全自定义 |

---

*文档结束*

flowchart TD
  L0[ L0 企业级知识库 `<br/>`（企业级底线约束）]
  L1[ L1 项目级知识库 `<br/>`（业务领域枢纽）]
  L2[ L2 仓库级知识库 `<br/>`（仓库内实施与文档）]

  L0 -->|继承约束| L1
  L1 -->|继承与扩展| L2

  L0_detail[内容示例：`<br/>`• 架构原则 `<br/>`• 安全规范 `<br/>`• 治理流程 `<br/>`• AI Coding 企业级约束]
  L1_detail[内容示例：`<br/>`• 技术栈规范 `<br/>`• 编码规范 `<br/>`• 领域模型与术语 `<br/>`• 对外 API 规范 `<br/>`• 业务流程设计]
  L2_detail[内容示例：`<br/>`• context.md（仓库上下文）`<br/>`• decisions.md（设计决策）`<br/>`• features/registry.json（特性注册表）`<br/>`• code-derived 文档（overview/module）]

  L0 --- L0_detail
  L1 --- L1_detail
  L2 --- L2_detail

```

```

<style>#mermaid-1764836911791{font-family:sans-serif;font-size:16px;fill:#333;}#mermaid-1764836911791 .error-icon{fill:#552222;}#mermaid-1764836911791 .error-text{fill:#552222;stroke:#552222;}#mermaid-1764836911791 .edge-thickness-normal{stroke-width:2px;}#mermaid-1764836911791 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1764836911791 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1764836911791 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1764836911791 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1764836911791 .marker{fill:#333333;}#mermaid-1764836911791 .marker.cross{stroke:#333333;}#mermaid-1764836911791 svg{font-family:sans-serif;font-size:16px;}#mermaid-1764836911791 .label{font-family:sans-serif;color:#333;}#mermaid-1764836911791 .label text{fill:#333;}#mermaid-1764836911791 .node rect,#mermaid-1764836911791 .node circle,#mermaid-1764836911791 .node ellipse,#mermaid-1764836911791 .node polygon,#mermaid-1764836911791 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1764836911791 .node .label{text-align:center;}#mermaid-1764836911791 .node.clickable{cursor:pointer;}#mermaid-1764836911791 .arrowheadPath{fill:#333333;}#mermaid-1764836911791 .edgePath .path{stroke:#333333;stroke-width:1.5px;}#mermaid-1764836911791 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1764836911791 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1764836911791 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1764836911791 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1764836911791 .cluster text{fill:#333;}#mermaid-1764836911791 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:sans-serif;font-size:12px;background:hsl(80,100%,96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1764836911791:root{--mermaid-font-family:sans-serif;}#mermaid-1764836911791:root{--mermaid-alt-font-family:sans-serif;}#mermaid-1764836911791 flowchart-v2{fill:apa;}</style>
