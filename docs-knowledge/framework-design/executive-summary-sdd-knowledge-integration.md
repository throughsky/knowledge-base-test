# SDD + 知识库集成方案-（优先落地满足实现开发环节)

## 一、核心目标

**一句话概括**：通过"规范驱动开发(SDD)"与"多级知识空间"的系统集成，让 AI 在编码各阶段自动遵循企业规范，从源头保障代码质量与合规性。

### 四大核心价值

|    序号    | 目标                               | 说明                                                                                                                             |
| :---------: | ---------------------------------- | -------------------------------------------------------------------------------------------------------------------------------- |
| **1** | **技术一致性与质量保证**     | 通过 L0 企业级约束（安全红线、架构底线、AI约束）强制执行，确保所有 AI 生成代码符合企业技术规范，实现跨项目、跨团队的技术标准统一 |
| **2** | **AI 深度理解业务**          | 通过知识库注入（术语词典、领域模型、业务规则），让 AI 真正理解业务上下文，生成符合业务语义的代码，而非仅完成技术实现             |
| **3** | **知识库 AI 驱动自动生成**   | L1/L2 级知识库采用 AI 自动扫描代码、自动生成，自动汇聚模式，降低人工维护成本，实现知识库的持续更新与演进                         |
| **4** | **全流程质量闭环**（远期）   | 未来扩展至集成测试、代码检视、CI/CD 阶段，通过自动化检查与规范校验，形成"开发→测试→检视→发布"全链路质量保障体系               |
| **5** | **知识库赋能业务侧**（远期） | 知识库能力向上游延伸，支撑产品设计辅助、项目快速理解、业务智能问答等场景，让 AI 不仅服务于开发，更服务于整个产品研发链路         |
| **6** | **AI 后台自动化**（远期）    | 结合远程沙箱、GitHub Actions 等技术，实现 AI 任务后台自动执行，减少人工干预，支持代码生成、测试执行、文档更新等全流程无人值守    |

---

## 二、解决的核心问题

| 当前痛点                      | 影响                                         | 本方案解决方式                                                            |
| ----------------------------- | -------------------------------------------- | ------------------------------------------------------------------------- |
| AI 生成代码不符合企业规范     | 返工率高、安全隐患                           | 各阶段自动注入对应规范文档                                                |
| AI 无法理解存量代码，存量业务 | 新代码与现有架构不一致、重复造轮子，功能蔓延 | L2 代码衍生文档（code-derived）自动生成，让 AI 理解现有模块结构与代码模式 |
| 架构决策缺乏历史参考          | 重复踩坑、决策冲突                           | 自动加载 ADR 历史记录                                                     |
| 术语混乱 + 知识库加载低效     | 沟通成本高、Token 浪费                       | 标准术语词典 + 按命令阶段精准加载                                         |

---

## 三、方案架构

### 3.1 三层知识空间

```
┌────────────────────────────────────────────┐
│  L0 企业级（不可覆盖）                       │
│  技术宪法 | 安全红线 | 合规要求 | AI约束     │
├────────────────────────────────────────────┤
│  L1 项目级（可细化）                         │
│  领域模型 | 术语词典 | 技术栈 | ADR决策      │
├────────────────────────────────────────────┤
│  L2 仓库级（可定制）                         │
│  仓库上下文 | 代码文档 | 特性归档            │
└────────────────────────────────────────────┘
```

**关键设计**：

- L0 约束**强制执行**，下级不可覆盖（如安全红线、架构底线，AI约束要求）。从而保证开发，写测试用例，代码review等环节有质量保证。这部分已经整理结束。
- L1/L2 可根据项目/仓库特点细化扩展。我们的目标还L1，L2两级知识库尽可能的使用技术手段，做到AI自动扫描代码，自动生成，自动汇聚。
- **AI 自动汇聚机制**：L2 仓库级知识定期向 L1 项目级聚合（代码变更摘要、模块依赖更新、跨仓库模式识别），L1 再向 L0 反馈技术趋势，形成知识自底向上的持续沉淀。
- 通过 Git Subtree 实现知识库自动同步

### 3.2 信息汇聚和继承机制

```
┌─────────────────────────────────────────────────────────────┐
│                    信息流向                                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  自底向上生成 (Upward Aggregation)                          │
│  ─────────────────────────────────                          │
│  仓库级 (L2)  ───AI定期聚合───→  项目级 (L1)  ───→  企业级  │
│                                                             │
│  • 收集 context.md 变更                                     │
│  • 收集 code-derived 文档                                   │
│  • 分析变更影响                                             │
│  • 生成聚合报告                                             │
│  • 更新项目文档                                             │
│                                                             │
│  自顶向下继承 (Downward Inheritance)                        │
│  ─────────────────────────────────                          │
│  企业级 (L0)  ───规范传递───→  项目级 (L1)  ───→  仓库级    │
│                                                             │
│  • 编码规范继承                                             │
│  • 技术选型约束                                             │
│  • 安全基线要求                                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**核心机制**：知识库形成双向流动闭环，L0 规范向下强制传递，L2 代码知识向上 AI 自动聚合，实现"规范落地 + 知识沉淀"的持续循环。

### 3.3 SDD 流程与知识库映射

**各阶段最主要命令职责说明**：

| 命令                | 职责               | 输入             | 输出                         |
| ------------------- | ------------------ | ---------------- | ---------------------------- |
| **specify**   | 需求：功能规格创建 | 自然语言需求描述 | 结构化功能规格文档 (spec.md) |
| **plan**      | 实施计划生成       | 功能规格         | 技术设计方案 (plan.md)       |
| **tasks**     | 任务列表生成       | 实施计划         | 可执行任务清单 (tasks.md)    |
| **implement** | 代码实现           | 任务清单         | 符合规范的代码               |

```
需求描述 → specify → plan → tasks → implement → 代码产出
           (规格化)  (设计)  (拆解)   (编码)
              ↓        ↓       ↓        ↓
           术语词典  架构原则  模块结构  编码规范
           领域模型  技术雷达  文件路径  安全红线
           仓库边界  ADR历史            AI约束
```

### 3.3 核心命令知识库加载策略

| 命令                | 必须加载                                                       | 核心约束   |
| ------------------- | -------------------------------------------------------------- | ---------- |
| **specify**   | L1 术语词典、领域模型 + L2 仓库上下文                          | 术语一致性 |
| **plan**      | L0 架构原则、安全红线、技术雷达 + L1 技术栈、ADR + L2 模块结构 | 架构合规   |
| **implement** | L0 编码规范、AI约束、安全红线 + L1 项目规范 + L2 模块文档      | 代码合规   |

---

## 四、预期收益

### 4.1 量化指标

| 指标         | 当前    | 目标   | 提升幅度        |
| ------------ | ------- | ------ | --------------- |
| 架构合规率   | ~60%    | >95%   | **+35%**  |
| 术语一致性   | ~70%    | >95%   | **+25%**  |
| 安全红线违规 | ~5次/月 | 0次/月 | **-100%** |
| 代码返工率   | ~20%    | <5%    | **-75%**  |

### 4.2 核心价值

1. **合规前置**：问题在设计阶段发现，而非上线后修复
2. **知识复用**：ADR、特性归档等历史经验自动传承
3. **效率提升**：按需加载减少 Token 消耗，提高响应速度
4. **质量门禁**：架构合规检查作为流程卡点，强制执行

---

## 五、实施路径

```
Phase 1（基础）    Phase 2（核心）    Phase 3（完善）    Phase 4（优化）
─────────────────────────────────────────────────────────────────────
知识库目录结构     plan 命令改造      辅助命令改造       Token 优化
配置文件设计       implement 改造     analyze/checklist  端到端测试
加载脚本实现       specify 改造       文档更新           效能度量
```

---

## 六、关键成功要素

### 技术层面

- 规范与测试双重驱动
- 三层知识架构支撑 AI 理解
- 统一工具链降低认知负担

### 组织层面

- 架构委员会维护 L0 企业级规范
- 项目组维护 L1 项目级知识
- AI 自动生成 L2 代码衍生文档（降低维护成本）

---

## 七、总结

本方案通过**"知识库分层 + SDD 流程集成"**，实现：

1. **企业规范强制执行**：安全、架构、合规约束不可绕过
2. **AI 理解上下文**：术语、架构、模式自动注入
3. **效率与质量兼顾**：精准加载、减少浪费、问题前置

**一句话价值**：让 AI 编码"懂规范、守底线、有上下文"，从"能用"提升到"可信赖"。

---

*详细技术方案请参阅：*

- *01-introduction.md - SDD 核心理念*
- *05-knowledge-spaces.md - 知识空间架构*
- *speckit-knowledge-integration-proposal.md - 集成实施方案*
